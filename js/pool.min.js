/*!
 * Cirquity - Cirquity v1.1.0 (https://cirquity.com)
 * Copyright 2020-2020 The Cirquity Developers
 * Licensed under MIT (https://github.com/cirquity/cirquity-explorer/blob/master/LICENSE)
 */

!function(t){let e,a=[],o=[],s=0,l=0,n=0,i=0,r=new Map(networkStat1[symbol.toLowerCase()]),c=new Map(networkStat2[symbol.toLowerCase()]);t((function(){currentPage="pool";let e=setInterval((function(){appReady&&(t.updatePool(),clearInterval(e))}),10);t("#calcHashRate").keyup(t.calcEstimateProfit).change(t.calcEstimateProfit),t("#calcHashUnits > li > a").click((function(e){e.preventDefault(),t("#calcHashUnit").text(t(this).text()).data("mul",t(this).data("mul")),t.calcEstimateProfit()})),r.forEach((function(e,o,n){void 0!==e&&t.getJSON(e+"/stats",(function(e,n,i){let r,c=new Date(parseInt(e.pool.lastBlockFound)),u=o.indexOf("/");r=u<0?o:o.substr(0,u),t("#pools-rows").append(t.renderPoolRow(o,r,e,c)),s+=parseInt(e.pool.hashrate),l+=parseInt(e.pool.miners),t.updateText("totalPoolsHashrate",t.getReadableHashRateString(s)+"/sec"),t.updateText("total_miners",t.localizeNumber(l)),a.push([r,parseInt(e.pool.hashrate),""])}))})),c.forEach((function(e,o,n){let i,r=o.indexOf("/");i=r<0?o:o.substr(0,r),void 0!==e&&t.getJSON(e+"/pool/stats",(function(n,r,c){let u=new Date(1e3*n.pool_statistics.lastBlockFoundTime),h=t.translateAPI2(n);t("#pools-rows").append(t.renderPoolRow(o,i,h,u)),s+=parseInt(n.pool_statistics.hashRate),l+=parseInt(n.pool_statistics.miners),t.updateText("totalPoolsHashrate",t.getReadableHashRateString(s)+"/sec"),t.updateText("total_miners",t.localizeNumber(l)),a.push([i,n.pool_statistics.hashRate,colorHash.hex(i)]),t.getJSON(e+"/network/stats",(function(e,a,o){t.updateText("height-"+i,t.localizeNumber(e.height))})),t.getJSON(e+"/config",(function(e,a,o){t.updateText("totalFee-"+i,"PPLNS: "+e.pplns_fee+"%,\nPPS: "+e.pps_fee+"%,\nSolo: "+e.solo_fee+"%"),t.updateText("minPayout-"+i,"Wallet: "+t.getReadableCoins(e.min_wallet_payout,2)+",\nExchange: "+t.getReadableCoins(e.min_exchange_payout,2))}))}))})),setInterval((function(){s=0,l=0,a=[],r.forEach((function(e,o,n){let i,r=o.indexOf("/");i=r<0?o:o.substr(0,r),t.getJSON(e+"/stats",(e,o,n)=>{let r=new Date(parseInt(e.pool.lastBlockFound)),c=renderDate(r);s+=parseInt(e.pool.hashrate),l+=parseInt(e.pool.miners),t.updateText("height-"+i,t.localizeNumber(e.network.height)),t.updateText("hashrate-"+i,t.localizeNumber(e.pool.hashrate)+" H/s"),t.updateText("miners-"+i,t.localizeNumber(e.pool.miners)),t.updateText("lastFound-"+i,c),t.updateText("totalPoolsHashrate",t.getReadableHashRateString(s)+"/sec"),t.updateText("total_miners",t.localizeNumber(l)),t.updateText("networkHashrate",t.getReadableHashRateString(lastStats.difficulty/blockTargetInterval)+"/sec"),t.updateText("networkDifficulty",t.getReadableDifficultyString(lastStats.difficulty,0).toString()),a.push([i,parseInt(e.pool.hashrate),""])})})),c.forEach((function(e,o,n){let i,r=o.indexOf("/");i=r<0?o:o.substr(0,r),t.getJSON(e+"/pool/stats",(e,o,n)=>{let r=new Date(1e3*e.pool_statistics.lastBlockFoundTime);renderDate(r);t.updateText("hashrate-"+i,t.localizeNumber(e.pool_statistics.hashRate)+" H/s"),t.updateText("miners-"+i,t.localizeNumber(e.pool_statistics.miners)),s+=parseInt(e.pool_statistics.hashRate),l+=parseInt(e.pool_statistics.miners),t.updateText("totalPoolsHashrate",t.getReadableHashRateString(s)+"/sec"),t.updateText("total_miners",t.localizeNumber(l)),a.push([i,e.pool_statistics.hashRate,""])}),t.getJSON(e+"/network/stats",(e,a,o)=>{t.updateText("height-"+i,t.localizeNumber(e.height))})}))}),12e4)})),t.updatePool=function(){t.updateText("networkHashrate",t.getReadableHashRateString(lastStats.difficulty/blockTargetInterval)+"/sec"),t.updateText("networkDifficulty",t.getReadableDifficultyString(lastStats.difficulty,0).toString()),t.getBlocks(),t.renderLastBlock()},t.getBlocks=function(){e&&e.abort(),e=t.ajax({url:api+"/json_rpc",method:"POST",data:JSON.stringify({jsonrpc:"2.0",id:"getBlocks",method:"f_blocks_list_json",params:{height:lastStats.height-1}}),dataType:"json",cache:"false",success:function(e){e.result&&t.when(t.renderBlocks(e.result.blocks)).then((function(){setTimeout((function(){t.calcAvgHashRate()}),100)}))}})},t.renderBlocks=function(t){for(let e=0;e<t.length;e++){const a=t[e];o.push(parseInt(a.difficulty))}},t.renderLastBlock=function(){t.ajax({url:api+"/json_rpc",method:"POST",data:JSON.stringify({jsonrpc:"2.0",id:"lastBlock",method:"getlastblockheader",params:{}}),dataType:"json",cache:"false",success:function(e){let a=e.result.block_header.hash;t.ajax({url:api+"/json_rpc",method:"POST",data:JSON.stringify({jsonrpc:"2.0",id:"block",method:"f_block_json",params:{hash:a}}),dataType:"json",cache:"false",success:function(t){const e=t.result.block;n=parseInt(e.baseReward)}})}})},t.renderPoolRow=function(e,a,o,s){let l=t.renderDate(s),n=[];return n.push("<tr>"),n.push('<th scope="row" id="host-'+a+'"><a target="_blank" href="http://'+e+'">'+a+"</a></th>"),n.push('<td id="height-'+a+'" class="height">'+t.localizeNumber(o.network.height)+"</td>"),n.push('<td id="hashrate-'+a+'">'+t.localizeNumber(o.pool.hashrate)+" H/s</td>"),n.push('<td id="miners-'+a+'">'+t.localizeNumber(o.pool.miners)+"</td>"),n.push('<td id="totalFee-'+a+'">'+t.calculateTotalFee(o)+"%</td>"),n.push('<td id="minPayout-'+a+'">'+t.getReadableCoins(o.config.minPaymentThreshold,2)+"</td>"),n.push('<td><span id="lastFound-'+a+'">'+l+"</span></td>"),n.push("</tr>"),n.join("")},t.calcAvgHashRate=function(){let e=o.reduce((function(t,e){return t+e}),0);i=Math.round(e/o.length);blockTargetInterval;t.updateText("avgDifficulty",t.getReadableDifficultyString(i,0).toString()),t.updateText("avgHashrate",t.getReadableHashRateString(i/blockTargetInterval))},t.calcEstimateProfit=function(){try{let e=Math.pow(1024,parseInt(t("#calcHashUnit").data("mul"))),a=parseFloat(t("#calcHashRate").val())*e,o=86400*a/i*n;if(console.log(e,a,o,n),o)return void t.updateText("calcHashAmount",t.getReadableCoins(o,2,!0))}catch(t){}t.updateText("calcHashAmount","0")},t.calculateTotalFee=function(t){let e=t.config.fee;for(let a in t.config.donation)t.config.donation.hasOwnProperty(a)&&(e+=t.config.donation[a]);return e},t.translateAPI2=function(t){return{network:{height:""},pool:{hashrate:t.pool_statistics.hashRate,miners:t.pool_statistics.miners},config:{minPaymentThreshold:""}}}}(jQuery);