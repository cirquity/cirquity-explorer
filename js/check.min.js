/*!
 * Cirquity - Cirquity v1.1.0 (https://cirquity.com)
 * Copyright 2020-2020 The Cirquity Developers
 * Licensed under MIT (https://github.com/cirquity/cirquity-explorer/blob/master/LICENSE)
 */

!function(e){let t,r=e("#transaction-hash"),n=e("#private-key"),o=e("#public-address"),l=e("#txn-link"),a=e("#outputs-rows");e((function(){currentPage="check";let t=setInterval((function(){appReady&&clearInterval(t)}),10);e("#check-transaction").click((function(){e.getTxn(r.val(),(function(t){if(t.error)alert(t.error.message);else{const s="view",c=e.checkTxn(t.result,n.val(),o.val(),s);if(c.error)l.attr("href",""),l.html("?"),alert(c.error);else{l.attr("href","transaction.html?hash="+r.val()),l.html(r.val()),a.html("");for(let e in c.owned)if(c.owned.hasOwnProperty(e)){let t=c.owned[e],r="<tr><td>"+t[2]+"</td><td>"+t[1]+"</td></tr>";a.append(r)}}}}))}))})),e.getTxn=function(r,n){t&&t.abort(),t=e.ajax({url:api+"/json_rpc",method:"POST",data:JSON.stringify({jsonrpc:"2.0",id:"blockexplorer",method:"f_transaction_json",params:{hash:r}}),dataType:"json",error:function(e){alert(e.error)},success:n})},e.checkTxn=function(t,r,n,o){let l=t.tx,a=t.txDetails,s=cnBase58.decode(n),c=a.hash,i={error:!1,total_owned:0,owned:[],unowned:[]};console.log(s);if(64!==r.length||!0!==e.validHex(r))i.error="Invalid private key";else if(99!==n.length||s.slice(-8)!==cn_fast_hash(s.slice(0,-8)).slice(0,8))i.error="Bad address";else if("view"===o&&s.slice(72,136)!==sec_key_to_pub(r))i.error="Secret View key does not match address";else if(64===c.length&&e.validHex(c)){let e=s.slice(72,136),t=cnUtil.generate_key_derivation(e,r),n=s.slice(8,72);console.log(t,n);for(let e=0;e<l.vout.length;e++){let r=cnUtil.derive_public_key(t,e,n),o=l.vout[e].amount/1e8;r===l.vout[e].target.data.key?(i.total_owned+=o,i.owned.push([e,r,o])):i.unowned.push([e,l.vout[e].target.key,o])}}else i.error="Invalid TXN Hash";return console.log(i),i},e.pubKeyFromExtra=function(e){let t=!1;for(console.log(e,e.length,e[0]);e.length>0&&0===e[0];)e=e.slice(1,e.length);return 1===e[0]&&e.length>=65&&(t=e.slice(1,65)),t}}(jQuery);