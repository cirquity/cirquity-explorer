/*!
 * Cirquity - Cirquity v1.1.0 (https://cirquity.com)
 * Copyright 2020-2020 The Cirquity Developers
 * Licensed under MIT (https://github.com/cirquity/cirquity-explorer/blob/master/LICENSE)
 */

!function(e){let t,r=e("#transaction-hash"),n=e("#private-key"),o=e("#public-address"),a=e("#txn-link"),l=e("#outputs-rows"),i=new TurtleCoinUtils.CryptoNote({coinUnitPlaces:2,addressPrefix:3934293,keccakIterations:1,defaultNetworkFee:10,fusionMinInputCount:12,fusionMinInOutCountRatio:4,mmMiningBlockVersion:2,maximumOutputAmount:1e11,maximumOutputsPerTransaction:90,maximumExtraSize:1024,activateFeePerByteTransactions:!1,feePerByte:1.953125,feePerByteChunkSize:256});e((function(){currentPage="check";let t=setInterval((function(){appReady&&clearInterval(t)}),10);e("#check-transaction").click((function(){e.getTxn(r.val(),(function(t){if(t.error)alert(t.error.message);else{const i="view",s=e.checkTxn(t.result,n.val(),o.val(),i);if(s.error)a.attr("href",""),a.html("?"),alert(s.error);else{a.attr("href","transaction.html?hash="+r.val()),a.html(r.val()),l.html("");for(let e in s.owned)if(s.owned.hasOwnProperty(e)){let t=s.owned[e],r="<tr><td>"+t[2]+"</td><td>"+t[1]+"</td></tr>";l.append(r)}}}}))}))})),e.getTxn=function(r,n){t&&t.abort(),t=e.ajax({url:api+"/json_rpc",method:"POST",data:JSON.stringify({jsonrpc:"2.0",id:"blockexplorer",method:"f_transaction_json",params:{hash:r}}),dataType:"json",error:function(e){alert(e.error)},success:n})},e.checkTxn=function(t,r,n,o){let a=t.tx,l=t.txDetails,s=i.decodeAddress(n),c=l.hash,u={error:!1,total_owned:0,owned:[],unowned:[]};console.log(s);if(64!==r.length||!0!==e.validHex(r))u.error="Invalid private key";else if(99!==n.length||s.slice(-8)!==cn_fast_hash(s.slice(0,-8)).slice(0,8))u.error="Bad address";else if("view"===o&&s.slice(72,136)!==sec_key_to_pub(r))u.error="Secret View key does not match address";else if(64===c.length&&e.validHex(c)){let t=s.slice(72,136);if("view"===o&&(t=e.pubKeyFromExtra(a.extra)),t){let e=cnUtil.generate_key_derivation(t,r),n=s.slice(8,72);console.log(e,n);for(let t=0;t<a.vout.length;t++){let r=cnUtil.derive_public_key(e,t,n),o=a.vout[t].amount/1e8;r===a.vout[t].target.data.key?(u.total_owned+=o,u.owned.push([t,r,o])):u.unowned.push([t,a.vout[t].target.key,o])}}else u.error="Unrecognized tx_extra format!"}else u.error="Invalid TXN Hash";return console.log(u),u},e.pubKeyFromExtra=function(e){let t=!1;for(console.log(e,e.length,e[0]);e.length>0&&0===e[0];)e=e.slice(1,e.length);return 1===e[0]&&e.length>=65&&(t=e.slice(1,65)),t}}(jQuery);