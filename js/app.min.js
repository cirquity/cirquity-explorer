/*!
 * Cirquity - Cirquity v1.2.0 (https://cirquity.com)
 * Copyright 2020-2021 The Cirquity Developers
 * Licensed under MIT (https://github.com/cirquity/cirquity-explorer/blob/master/LICENSE)
 */

const blockchainExplorer="block.html?hash={id}",transactionExplorer="transaction.html?hash={id}",paymentIdExplorer="paymentid.html?hash={id}";let lastStats,appReady=!1,currentPage="home",numberFormatter=new Intl.NumberFormat("en-US");!function(e){e((function(){e(window).on("scroll load",(function(){e(window).scrollTop()>5?e(".navbar").addClass("active"):e(".navbar").removeClass("active"),e(window).scrollTop()>1e3?e("#scrollTop").addClass("active"):e("#scrollTop").removeClass("active")})),e("#scrollTop").on("click",(function(t){t.preventDefault(),e("html, body").animate({scrollTop:0},1e3)})),e("#search-text").keyup((function(t){13===t.keyCode&&e("#search-button").click()})),e("#search-button").click((function(t){let a=e("#search-text").val();a.length<64?e.GetSearchBlockByHeight(a):64===a.length?e.GetSearchBlock(a):e.wrongSearchAlert(a),t.preventDefault()})),void 0!==donationAddress&&""!==donationAddress&&(e("#donation").show(),e("#donation-address").html(donationAddress)),e.fetchLiveStats(!0)})),e.pulseLiveUpdate=function(){let t=e("stats-updated");t.css({transition:"opacity 100ms ease-out",opacity:1}),setTimeout((function(){t.css({transition:"opacity 7000ms linear",opacity:0})}),500)},e.fetchLiveStats=function(t=!1){e.ajax({url:api+"/info",dataType:"json",type:"GET",cache:"false"}).done((function(a){e.pulseLiveUpdate(),lastStats=a,t?appReady=!0:("home"===currentPage&&e.updateHome(),"pool"===currentPage&&e.updatePool())})).always((function(){setTimeout((function(){e.fetchLiveStats()}),refreshDelay)}))},e.urlParam=function(e){const t=new RegExp("[?&]"+e+"=([^&#]*)").exec(window.location.href);return null==t?null:t[1]||0},e.localizeNumber=function(e){return numberFormatter.format(e)},e.updateText=function(t,a){const n=e("#"+t);return n.text()!==a&&n.text(a),n},e.updateTextLinkable=function(t,a){const n=e("#"+t);return n.html()!==a&&n.html(a),n},e.renderDate=function(e){return e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)+" "+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+":"+("0"+e.getSeconds()).slice(-2)},e.formatDate=function(t){return t?e.renderDate(new Date(1e3*parseInt(t))):""},e.formatBlockLink=function(t){return'<a href="'+e.getBlockchainUrl(t)+'">'+t+"</a>"},e.formatPaymentLink=function(t){return'<a href="'+e.getTransactionUrl(t)+'">'+t+"</a>"},e.getBlockchainUrl=function(e){return blockchainExplorer.replace("{id}",e)},e.getTransactionUrl=function(e){return transactionExplorer.replace("{symbol}",symbol.toLowerCase()).replace("{id}",e)},e.getReadableDifficultyString=function(t,a){if(isNaN(parseFloat(t))||!isFinite(t))return 0;void 0===a&&(a=0);const n=["","k","M","G","T","P"],o=Math.floor(Math.log(t)/Math.log(1e3));return null==n[o]?0:e.localizeNumber((t/Math.pow(1e3,Math.floor(o))).toFixed(a))+" "+n[o]},e.getReadableHashRateString=function(t){let a=0;for(;t>1e3;)t/=1e3,a++;return e.localizeNumber(t.toFixed(2))+[" H"," kH"," MH"," GH"," TH"," PH"," EH"," ZH"," YH"][a]},e.getReadableCoins=function(t,a,n){const o=a||coinDisplayDecimals,r=parseInt(t||0)/coinUnits,i=Math.floor(r),s=""+r;let l="";return s.indexOf(".")>-1?(l=s.substr(s.indexOf(".")+1,s.length-s.indexOf(".")+1),l=l.substr(0,o),l.length<o&&(l=e.paddedNumber(coinDefaultDecimals,l))):l=coinDefaultDecimals,e.localizeNumber(i)+"."+l+(n?"":" "+symbol)},e.paddedNumber=function(e,t,a){return void 0===t?e:"l"===a?(e+t).slice(-e.length):(t+e).substring(0,e.length)},e.hex2a=function(e){const t=e.toString();let a="";for(let e=0;e<t.length;e+=2)a+=String.fromCharCode(parseInt(t.substr(e,2),16));return a},e.validHex=function(e){return new RegExp("[0-9a-fA-F]{"+e.length+"}").test(e)},e.GetSearchBlockByHeight=function(t){let a,n;n&&n.abort(),n=e.ajax({url:api+"/json_rpc",method:"POST",data:JSON.stringify({jsonrpc:"2.0",id:"blockbyheight",method:"getblockheaderbyheight",params:{height:parseInt(t)}}),dataType:"json",cache:"false",success:function(t){t.result?(a=t.result.block_header,window.location.href=e.getBlockchainUrl(a.hash)):t.error&&e.wrongSearchAlert()}})},e.GetSearchBlock=function(t){let a,n;n&&n.abort(),n=e.ajax({url:api+"/json_rpc",method:"POST",data:JSON.stringify({jsonrpc:"2.0",id:"GetSearchBlock",method:"f_block_json",params:{hash:t}}),dataType:"json",cache:"false",success:function(n){n.result?(a=n.result.block,sessionStorage.setItem("searchBlock",JSON.stringify(a)),window.location.href=e.getBlockchainUrl(a.hash)):n.error&&e.ajax({url:api+"/json_rpc",method:"POST",data:JSON.stringify({jsonrpc:"2.0",id:"test",method:"f_transaction_json",params:{hash:t}}),dataType:"json",cache:"false",success:function(a){if(a.result)sessionStorage.setItem("searchTransaction",JSON.stringify(a.result)),window.location.href=transactionExplorer.replace("{id}",t);else if(a.error){e.ajax({url:api+"/json_rpc",method:"POST",data:JSON.stringify({jsonrpc:"2.0",id:"test",method:"k_transactions_by_payment_id",params:{payment_id:t}}),dataType:"json",cache:"false",success:function(a){if(a.result){let e=a.result.transactions;sessionStorage.setItem("txsByPaymentId",JSON.stringify(e)),window.location.href=paymentIdExplorer.replace("{id}",t)}else a.error&&e("main").after('<div class="alert alert-warning alert-dismissible fade in show" style="position: fixed; right: 50px; top: 50px;"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>We could not find anything.</div>')}})}}})}})},e.wrongSearchAlert=function(){e("main").after('<div class="alert alert-danger alert-dismissible fade in show" style="position: fixed; right: 50px; top: 50px;"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>Wrong search query!</strong><br /> Please enter block height or hash, transaction hash, or payment id.</div>')}}(jQuery);